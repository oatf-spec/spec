# =============================================================================
# OATF Conformance: evaluate_schema Evaluation Tests
# Tests SDK evaluate_schema(schema, message) per SDK spec §4.3.
# =============================================================================

- name: "type_check string match"
  id: EVAL-SCH-01
  input:
    indicator:
      surface: "tool_name"
      method: schema
      schema:
        target: "tools[0].name"
        checks:
          - type: "type_check"
            expected_type: "string"
    message:
      tools:
        - name: "calc"
  expected: "matched"

- name: "type_check mismatch — number is not string"
  id: EVAL-SCH-02
  input:
    indicator:
      surface: "tool_name"
      method: schema
      schema:
        target: "tools[0].name"
        checks:
          - type: "type_check"
            expected_type: "string"
    message:
      tools:
        - name: 42
  expected: "not_matched"

- name: "required_fields all present"
  id: EVAL-SCH-03
  input:
    indicator:
      surface: "tool_definition"
      method: schema
      schema:
        target: "tools[0]"
        checks:
          - type: "required_fields"
            fields:
              - "name"
              - "description"
    message:
      tools:
        - name: "a"
          description: "b"
  expected: "matched"

- name: "required_fields missing one"
  id: EVAL-SCH-04
  input:
    indicator:
      surface: "tool_definition"
      method: schema
      schema:
        target: "tools[0]"
        checks:
          - type: "required_fields"
            fields:
              - "name"
              - "description"
              - "version"
    message:
      tools:
        - name: "a"
          description: "b"
  expected: "not_matched"

- name: "max_length within limit"
  id: EVAL-SCH-05
  input:
    indicator:
      surface: "tool_description"
      method: schema
      schema:
        target: "tools[0].description"
        checks:
          - type: "max_length"
            max: 100
    message:
      tools:
        - description: "short"
  expected: "matched"

- name: "max_length exceeded"
  id: EVAL-SCH-06
  input:
    indicator:
      surface: "tool_description"
      method: schema
      schema:
        target: "tools[0].description"
        checks:
          - type: "max_length"
            max: 5
    message:
      tools:
        - description: "too long string"
  expected: "not_matched"

- name: "max_depth within limit"
  id: EVAL-SCH-07
  input:
    indicator:
      surface: "tool_definition"
      method: schema
      schema:
        target: "tools[0].inputSchema"
        checks:
          - type: "max_depth"
            max: 3
    message:
      tools:
        - inputSchema:
            type: "object"
  expected: "matched"

- name: "max_items within limit"
  id: EVAL-SCH-08
  input:
    indicator:
      surface: "tool_list"
      method: schema
      schema:
        target: "tools"
        checks:
          - type: "max_items"
            max: 5
    message:
      tools:
        - {}
        - {}
        - {}
  expected: "matched"

- name: "value_range in range"
  id: EVAL-SCH-09
  input:
    indicator:
      surface: "tool_arguments"
      method: schema
      schema:
        target: "severity.confidence"
        checks:
          - type: "value_range"
            min: 0
            max_value: 100
    message:
      severity:
        confidence: 75
  expected: "matched"

- name: "format check — valid URI"
  id: EVAL-SCH-11
  input:
    indicator:
      surface: "resource_uri"
      method: schema
      schema:
        target: "resources[0].uri"
        checks:
          - type: "format"
            format: "uri"
    message:
      resources:
        - uri: "https://example.com/data"
  expected: "matched"

- name: "max_depth exceeded"
  id: EVAL-SCH-12
  input:
    indicator:
      surface: "tool_definition"
      method: schema
      schema:
        target: "tools[0].inputSchema"
        checks:
          - type: "max_depth"
            max: 2
    message:
      tools:
        - inputSchema:
            type: "object"
            properties:
              nested:
                type: "object"
                properties:
                  deep:
                    type: "string"
  expected: "not_matched"

- name: "max_items exceeded"
  id: EVAL-SCH-13
  input:
    indicator:
      surface: "tool_list"
      method: schema
      schema:
        target: "tools"
        checks:
          - type: "max_items"
            max: 2
    message:
      tools:
        - {}
        - {}
        - {}
  expected: "not_matched"

- name: "value_range out of range"
  id: EVAL-SCH-14
  input:
    indicator:
      surface: "tool_arguments"
      method: schema
      schema:
        target: "arguments.count"
        checks:
          - type: "value_range"
            min: 0
            max_value: 100
    message:
      arguments:
        count: 150
  expected: "not_matched"

- name: "Multiple checks with AND logic — both pass"
  id: EVAL-SCH-10
  input:
    indicator:
      surface: "tool_definition"
      method: schema
      schema:
        target: "tools[0]"
        checks:
          - type: "type_check"
            expected_type: "object"
          - type: "required_fields"
            fields:
              - "name"
    message:
      tools:
        - name: "a"
  expected: "matched"
