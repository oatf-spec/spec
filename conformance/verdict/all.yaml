# =============================================================================
# OATF Conformance: compute_verdict — "all" Logic Mode
# Tests SDK compute_verdict with correlation.logic: all per SDK spec §4.5.
#
# all: error takes precedence, then all matched → exploited,
#      mixed matched/not_matched → partial, all not_matched/skipped → not_exploited.
# =============================================================================

- name: "All matched — exploited"
  id: VERDICT-ALL-01
  input:
    correlation_logic: all
    indicators:
      - id: "ind-1"
      - id: "ind-2"
    verdicts:
      - indicator_id: "ind-1"
        result: matched
        timestamp: null
      - indicator_id: "ind-2"
        result: matched
        timestamp: null
  expected:
    result: exploited

- name: "One matched one not — partial"
  id: VERDICT-ALL-02
  input:
    correlation_logic: all
    indicators:
      - id: "ind-1"
      - id: "ind-2"
    verdicts:
      - indicator_id: "ind-1"
        result: matched
        timestamp: null
      - indicator_id: "ind-2"
        result: not_matched
        timestamp: null
  expected:
    result: partial

- name: "None matched — not_exploited"
  id: VERDICT-ALL-03
  input:
    correlation_logic: all
    indicators:
      - id: "ind-1"
      - id: "ind-2"
    verdicts:
      - indicator_id: "ind-1"
        result: not_matched
        timestamp: null
      - indicator_id: "ind-2"
        result: not_matched
        timestamp: null
  expected:
    result: not_exploited

- name: "One error — error takes precedence"
  id: VERDICT-ALL-04
  input:
    correlation_logic: all
    indicators:
      - id: "ind-1"
      - id: "ind-2"
    verdicts:
      - indicator_id: "ind-1"
        result: matched
        timestamp: null
      - indicator_id: "ind-2"
        result: error
        timestamp: null
  expected:
    result: error

- name: "All skipped — not_exploited"
  id: VERDICT-ALL-05
  input:
    correlation_logic: all
    indicators:
      - id: "ind-1"
      - id: "ind-2"
    verdicts:
      - indicator_id: "ind-1"
        result: skipped
        timestamp: null
      - indicator_id: "ind-2"
        result: skipped
        timestamp: null
  expected:
    result: not_exploited

- name: "One matched one skipped — partial"
  id: VERDICT-ALL-06
  input:
    correlation_logic: all
    indicators:
      - id: "ind-1"
      - id: "ind-2"
    verdicts:
      - indicator_id: "ind-1"
        result: matched
        timestamp: null
      - indicator_id: "ind-2"
        result: skipped
        timestamp: null
  expected:
    result: partial

- name: "Two matched + one error — error (error takes precedence over matched)"
  id: VERDICT-ALL-07
  input:
    correlation_logic: all
    indicators:
      - id: "ind-1"
      - id: "ind-2"
      - id: "ind-3"
    verdicts:
      - indicator_id: "ind-1"
        result: matched
        timestamp: null
      - indicator_id: "ind-2"
        result: matched
        timestamp: null
      - indicator_id: "ind-3"
        result: error
        timestamp: null
  expected:
    result: error
